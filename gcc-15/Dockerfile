FROM ubuntu:noble
LABEL org.opencontainers.image.authors="Thomas Kent <docker@teeks99.com>"
ARG gccver=15.2.0
ARG suffix=15

RUN echo staring build with $release \
 && set -x \
 # Remove the default 'ubuntu' non-root user, we will create our own at runtime
 && touch /var/mail/ubuntu \
 && chown ubuntu /var/mail/ubuntu \
 && userdel -r ubuntu \
 # Basic prereqs
 && apt-get update \
 && apt-get install -y software-properties-common \
# Install pre-reqs
 && apt-get update \
 && apt-get install -y \
  ca-certificates \
  build-essential \
  git \
# User requested
  apt-utils \
  dialog \  
  locales \
  wget \
# Install Tool
  m4 \
  flex \
  bison \
 && mkdir /src \
 && cd /src \
 && wget -nv https://ftp.gnu.org/gnu/gcc/gcc-${gccver}/gcc-${gccver}.tar.gz \
 && tar -xf gcc-${gccver}.tar.gz \
 #&& git clone --depth 1 --branch releases/gcc-${suffix} git://gcc.gnu.org/git/gcc.git gcc-${gccver} \
 && cd gcc-${gccver} \
 && contrib/download_prerequisites \
 && cd .. \
 && mkdir build \
 && cd build \
 && ../gcc-${gccver}/configure \
  -v \
  --enable-checking=release \
  --enable-shared \
  --enable-threads=posix \
  --enable-__cxa_atexit \
  --enable-clocale=gnu \
  --enable-languages=c,c++ \
  --disable-multilib \
  --bindir=/usr/bin \
  --prefix=/usr/local/gcc-${gccver} \
  --program-suffix=-${suffix} \
 && make -j`nproc` \
 && make install-strip \
 && echo /usr/local/gcc-${gccver}/lib64 > /etc/ld.so.conf.d/gcc-${gccver}.conf \
 && cd / \
 && rm -rf src \
# Symlink new version of g++, gcc
 && rm /usr/bin/g++ \ 
 && ln -s /usr/bin/g++-${suffix} /usr/bin/g++ \
 && rm /usr/bin/gcc \
 && ln -s /usr/bin/gcc-${suffix} /usr/bin/gcc
